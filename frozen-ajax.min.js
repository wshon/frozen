!function(){if(document.getElementById("body").hasAttribute("in-pjax")){function ac(){$body=$("html,body");var g=".comment-list",h=".comment-num",i=".comment-reply a",wi=".whisper-reply",j="#textarea",k="",l="";function c(){$(i+","+wi).click((function(){l=$(this).parent().parent().parent().attr("id")})),$("#cancel-comment-reply-link").click((function(){l=""}))}c(),$("#comment-form").submit((function(){return $.ajax({url:$(this).attr("action"),type:"post",data:$(this).serializeArray(),error:function(){return alert("提交失败，请检查网络并重试或者联系管理员。"),!1},success:function(d){if(!$(g,d).length)return alert("您输入的内容不符合规则或者回复太频繁，请修改内容或者稍等片刻。"),!1;var f;k=$(g,d).html().match(/id=\"?comment-\d+/g).join().match(/\d+/g).sort((function(a,b){return a-b})).pop(),$(".page-navigator .prev").length&&""==l&&(k=""),l?(d=$("#li-comment-"+k,d).hide(),$("#"+l).find(".comment-children").length<=0&&$("#"+l).append("<div class='comment-children'><ol class='comment-list'></ol></div>"),k&&$("#"+l+" .comment-children .comment-list").prepend(d),l=""):(d=$("#li-comment-"+k,d).hide(),$(g).length||$("#comments").prepend("<h3>已有 <span class='comment-num'>0</span> 条评论</h3><ol class='comment-list'></ol>"),$(g).prepend(d)),$("#li-comment-"+k).fadeIn(),$(h).length&&(f=parseInt($(h).text().match(/\d+/)),$(h).html($(h).html().replace(f,f+1))),TypechoComment.cancelReply(),$(j).val(""),$(i+","+wi+", #cancel-comment-reply-link").unbind("click"),c(),k?$body.animate({scrollTop:$("#li-comment-"+k).offset().top-50},300):$body.animate({scrollTop:$("#comments").offset().top-50},300)}}),!1}))}if(jQuery.fn.Shake=function(n,d){return this.each((function(){var a=$(this);a.css({position:"relative"});for(var x=1;x<=n;x++)a.animate({left:-d},50).animate({left:d},50).animate({left:0},50)})),this},$(document).pjax('a:not(a[target="_blank"], a[no-pjax])',{container:"#main",fragment:"#main",timeout:1e4}).on("submit","form[id=search], form[id=comment-form]",(function(a){$.pjax.submit(a,{container:"#main",fragment:"#main",timeout:1e4})})).on("pjax:send",(function(){$("#header").prepend("<div id='bar'></div>")})).on("pjax:complete",(function(){setTimeout((function(){$("#bar").remove()}),300),$("#header").removeClass("on"),$("#s").val(""),$("#secondary").removeAttr("style"),"undefined"!=typeof hljs&&document.querySelectorAll("pre code").forEach(block=>{hljs.highlightBlock(block)})})).on("pjax:end",(function(){$(".ajaxload").length&&al(),cl(),ac(),ap(),"undefined"!=typeof _hmt&&_hmt.push(["_trackPageview",location.pathname+location.search]),"undefined"!=typeof ga&&ga("send","pageview",location.pathname+location.search)})),ac(),document.getElementById("token"))var protoken=document.getElementById("token").value.replace("Token","");function ap(){$(".protected .post-title a, .protected .more a").click((function(){var a=$(this).parent().parent();return a.find(".word").text("请输入密码访问").css("color","red").Shake(2,10),a.find(":password").focus(),!1})),$(".protected form").submit((function(){return ap_btn=$(this),ap_m=ap_btn.parent().find(".more a"),ap_n=ap_btn.find(".word"),$(ap_m).addClass("loading").text("请稍等"),$(".ajaxload").length?aps():apt(),!1}))}function apt(){var b=$(".protected .post-title a").attr("href");$("h1.post-title").length?(protoken=$(".protected form").attr("action").replace(b,""),aps()):$.ajax({url:window.location.href,success:function(d){protoken=$('.protected form[action^="'+b+'"]',d).attr("action").replace(b,""),aps()}})}function aps(){var c=ap_btn.parent().parent().find(".post-title a").attr("href");function rt(){$(ap_m).removeAttr("class").text("- 阅读全文 -")}$.ajax({url:c+protoken,type:"post",data:ap_btn.serializeArray(),error:function(){return rt(),ap_n.text("提交失败，请检查网络并重试或者联系管理员。").css("color","red").Shake(2,10),!1},success:function(d){if(!$("h1.post-title",d).length)return rt(),ap_n.text("对不起,您输入的密码错误。").css("color","red").Shake(2,10),$(":password").val(""),!1;rt(),$("h1.post-title").length?$.pjax.reload({container:"#main",fragment:"#main",timeout:1e4}):$.pjax({url:c,container:"#main",fragment:"#main",timeout:1e4})}})}ap()}var isbool=!0;function al(){$('.ajaxload li[class!="next"]').remove(),$(".ajaxload .next a").click((function(){return isbool&&aln(),!1}))}function aln(){var a=".ajaxload .next a",b=$(a).attr("href");$(a).addClass("loading").text("正在加载"),b&&$.ajax({url:b,error:function(){return alert("请求失败，请检查网络并重试或者联系管理员"),$(a).removeAttr("class").text("查看更多"),!1},success:function(d){var c=$(d).find("#main .post"),e=$(d).find(a).attr("href");return c&&$(".ajaxload").before(c),$(a).removeAttr("class"),e?$(a).text("查看更多").attr("href",e):($(a).remove(),$(".ajaxload .next").text("没有更多文章了")),$(".protected",d).length&&($(".protected *").unbind(),ap()),isbool=!0,!1}})}document.getElementsByClassName("ajaxload").length&&(al(),$(".ajaxload.auto").length&&$(window).scroll((function(){isbool&&$(".ajaxload .next a").attr("href")&&$(this).scrollTop()+$(window).height()+5>=$(document).height()&&(isbool=!1,aln())})))}();